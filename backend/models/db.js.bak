const { Low } = require('lowdb')
const { JSONFile } = require('lowdb/node')
const path = require('path')

const file = path.join(__dirname, '../data/db.json')
const adapter = new JSONFile(file)

// ✅ 必须提供默认数据
const defaultData = {
  users: [],
  config: {
    prizes: {
      1: 3000000,
      2: 1200000,
      3: 500000,
      '4-20': 50000,
      '21-100': 5000
    }
  }
}

const db = new Low(adapter, defaultData)

async function initDB() {
  await db.read()
  // db.data 已经由 defaultData 保证存在
  await db.write()
}

initDB()

module.exports = db

